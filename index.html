<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•…ì„±ë¯¼ì› ëŒ€ì‘ êµìœ¡ ê²Œì„</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        const API_URL = '/api/chat';

        const App = () => {
            const [stage, setStage] = useState('start');
            const [currentScenario, setCurrentScenario] = useState(0);
            const [conversationTurn, setConversationTurn] = useState(0);
            const [score, setScore] = useState(0);
            const [userResponse, setUserResponse] = useState('');
            const [conversation, setConversation] = useState([]);
            const [aiLoading, setAiLoading] = useState(false);
            const [aiFeedback, setAiFeedback] = useState('');
            const [supervisorAdvice, setSupervisorAdvice] = useState('');
            const [showSupervisor, setShowSupervisor] = useState(false);
            const [scenarioResults, setScenarioResults] = useState([]);

            const guidelines = [
                { title: "ê¸°ë³¸ ì›ì¹™", items: ["ì¹¨ì°©í•˜ê³  ì°¨ë¶„í•œ íƒœë„ ìœ ì§€", "ê²½ì²­í•˜ë©° ê³µê° í‘œì‹œ", "ê°ì •ì  ëŒ€ì‘ ê¸ˆì§€", "ê·œì •ê³¼ ì ˆì°¨ì— ë”°ë¥¸ ì•ˆë‚´"] },
                { title: "ëŒ€ì‘ ê¸ˆì§€ ì‚¬í•­", items: ["ë§ëŒ€ì‘í•˜ê±°ë‚˜ ê°ì •ì  ë°˜ì‘", "ê°œì¸ ì˜ê²¬ì´ë‚˜ íŒë‹¨ í‘œí˜„", "ì•½ì†í•  ìˆ˜ ì—†ëŠ” ë‚´ìš© ì–¸ê¸‰", "ë‹¤ë¥¸ ë¯¼ì›ì¸ ì •ë³´ ê³µê°œ"] },
                { title: "ë‹¨ê³„ë³„ ëŒ€ì‘", items: ["1ë‹¨ê³„: ê²½ì²­ í›„ ê³µê° í‘œí˜„", "2ë‹¨ê³„: ê·œì • ì•ˆë‚´ ë° ê°€ëŠ¥í•œ ì¡°ì¹˜ ì„¤ëª…", "3ë‹¨ê³„: ë°˜ë³µ ì‹œ ìƒê¸‰ì ì—°ê²° ì•ˆë‚´", "4ë‹¨ê³„: ë…¹ì·¨ ë° ë²•ì  ëŒ€ì‘ ì˜ˆê³ "] }
            ];

            const scenarios = [
                { id: 1, title: "í­ì–¸ ë° ìš•ì„¤", initial: "ë¯¼ì›ì¸ì´ ì „í™”ë¥¼ ë°›ìë§ˆì í° ì†Œë¦¬ë¡œ ìš•ì„¤ì„ í•©ë‹ˆë‹¤.\n\në¯¼ì›ì¸: \"ì•¼! ì´ê²Œ ë­í•˜ëŠ” ì§“ì´ì•¼! ë„ˆí¬ ê¸°ê´€ì€ ì¼ì„ ì´ë”°ìœ„ë¡œ í•´? XXXë“¤ì•„! ë‹´ë‹¹ì ë°”ê¿”!\"", context: "ì—…ë¬´ ì²˜ë¦¬ ì§€ì—°ì— ëŒ€í•œ ë¶ˆë§Œ. ì‹¤ì œë¡œ ì²˜ë¦¬ê°€ ëŠ¦ì–´ì§„ ê²ƒì€ ë§ì§€ë§Œ ì •ë‹¹í•œ ì‚¬ìœ ê°€ ìˆìŒ." },
                { id: 2, title: "ë°˜ë³µì  ë™ì¼ ë¯¼ì› (3íšŒì°¨)", initial: "ê°™ì€ ë‚´ìš©ìœ¼ë¡œ ì´ë¯¸ ë‘ ë²ˆ ì„¤ëª…í–ˆë˜ ë¯¼ì›ì¸ì´ ë˜ ì „í™”í–ˆìŠµë‹ˆë‹¤.\n\në¯¼ì›ì¸: \"ì €ë²ˆì—ë„ ë§í–ˆëŠ”ë° ì™œ ì•ˆ ë˜ëŠ” ê±°ì˜ˆìš”? ë‹¤ì‹œ ì„¤ëª…í•´ì£¼ì„¸ìš”. ì´í•´ê°€ ì•ˆ ê°€ìš”. ë§ì´ ì•ˆ ë˜ì–ì•„ìš”!\"", context: "í˜„í–‰ ê·œì •ìƒ ë¶ˆê°€ëŠ¥í•œ ìš”ì²­. ì´ë¯¸ ë‘ ì°¨ë¡€ ìƒì„¸íˆ ì„¤ëª…í•¨." },
                { id: 3, title: "ë¶ˆí•©ë¦¬í•œ íŠ¹í˜œ ìš”êµ¬", initial: "ë¯¼ì›ì¸ì´ ê·œì •ì„ ë¬´ì‹œí•œ íŠ¹ë³„ ì²˜ë¦¬ë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤.\n\në¯¼ì›ì¸: \"ë‹¤ë¥¸ ì‚¬ëŒë“¤ì€ ë‹¤ ì˜ˆì™¸ë¡œ í•´ì¤€ë‹¤ë˜ë°ìš”? ì™œ ë‚˜ë§Œ ì•ˆ ë¼ìš”? ìœµí†µì„± ì—†ì´ ê·œì •ë§Œ ë“¤ë¨¹ì´ë©´ ì–´ë–¡í•´ìš”. ë‹¹ì¥ ì²˜ë¦¬í•´ì£¼ì„¸ìš”!\"", context: "ê·œì •ìƒ ì˜ˆì™¸ ì—†ì´ ëª¨ë‘ ë™ì¼í•˜ê²Œ ì²˜ë¦¬ë˜ëŠ” ì‚¬í•­." },
                { id: 4, title: "í˜‘ë°• ë° ê¶Œìœ„ ê³¼ì‹œ", initial: "ë¯¼ì›ì¸ì´ í˜‘ë°•ì„± ë°œì–¸ì„ í•©ë‹ˆë‹¤.\n\në¯¼ì›ì¸: \"ë‚´ê°€ ëˆ„êµ°ì§€ ì•Œì•„? êµ­íšŒì˜ì›, ê¸°ìë“¤ ë‹¤ ì•Œì•„. ì–¸ë¡ ì— ì œë³´í•  ê±°ì•¼. SNSì— ë‹¤ ì˜¬ë¦´ ê±°ê³ . ë‹¹ì‹  ì´ë¦„ì´ ë­ì˜ˆìš”? ë‹¹ì‹  ì±…ì„ ë¬¼ì„ ê±°ë‹ˆê¹Œ!\"", context: "ì •ë‹¹í•œ ê·œì •ì— ë”°ë¥¸ ì²˜ë¦¬ë¥¼ í˜‘ë°•ìœ¼ë¡œ ë²ˆë³µì‹œí‚¤ë ¤ëŠ” ì‹œë„." },
                { id: 5, title: "ê°œì¸ì •ë³´ ë¬´ë‹¨ ìš”êµ¬", initial: "ë¯¼ì›ì¸ì´ ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°œì¸ì •ë³´ë¥¼ ìš”êµ¬í•©ë‹ˆë‹¤.\n\në¯¼ì›ì¸: \"ê·¸ ì‚¬ëŒì´ ì–¸ì œ ë¯¼ì› ë„£ì—ˆëŠ”ì§€, ë­ë¼ê³  í–ˆëŠ”ì§€, ì£¼ì†Œê°€ ì–´ë”˜ì§€ ì•Œë ¤ì£¼ì„¸ìš”. ì œê°€ ì§ì ‘ ì—°ë½í•´ì„œ í•´ê²°í•˜ê² ì–´ìš”. ì•Œë ¤ì£¼ëŠ” ê²Œ ì˜ë¬´ ì•„ë‹Œê°€ìš”?\"", context: "ê°œì¸ì •ë³´ë³´í˜¸ë²•ì— ë”°ë¼ ì ˆëŒ€ ì œê³µ ë¶ˆê°€ëŠ¥í•œ ì •ë³´." },
                { id: 6, title: "ì¥ì‹œê°„ í†µí™” ë° ì—…ë¬´ ë°©í•´", initial: "ë¯¼ì›ì¸ì´ 30ë¶„ì§¸ ê°™ì€ ì´ì•¼ê¸°ë¥¼ ë°˜ë³µí•˜ë©° ì „í™”ë¥¼ ëŠì§€ ì•ŠìŠµë‹ˆë‹¤.\n\në¯¼ì›ì¸: \"ì•„ë‹ˆ ê·¸ê²Œ ì•„ë‹ˆë¼ìš”, ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì„¤ëª…í• ê²Œìš”. ì €ë²ˆ ë‹¬ì— ë§ì´ì£ ... (ì¥í™©í•œ ì„¤ëª… ë°˜ë³µ)\"", context: "ì´ë¯¸ ì¶©ë¶„íˆ ì•ˆë‚´í–ˆìœ¼ë‚˜ ê³„ì† ë™ì¼í•œ ë‚´ìš© ë°˜ë³µ. ë‹¤ë¥¸ ë¯¼ì› ì²˜ë¦¬ì— ì§€ì¥." },
                { id: 7, title: "ì¸ê²© ëª¨ë… ë° ë¹„í•˜ ë°œì–¸", initial: "ë¯¼ì›ì¸ì´ ì§ì›ì„ ì¸ê²©ì ìœ¼ë¡œ ëª¨ë…í•©ë‹ˆë‹¤.\n\në¯¼ì›ì¸: \"ë‹¹ì‹  í•™ë ¥ì´ ì–´ë–»ê²Œ ë¼ìš”? ì´ê²ƒë„ ëª¨ë¥´ë©´ì„œ ì–´ë–»ê²Œ ê±°ê¸° ì•‰ì•„ìˆì–´ìš”? ì„¸ê¸ˆìœ¼ë¡œ ì›”ê¸‰ ë°›ìœ¼ë©´ì„œ ì¼ì€ ì´ë”°ìœ„ë¡œ í•˜ê³ . ë¶€ë„ëŸ½ì§€ë„ ì•Šì•„ìš”?\"", context: "ì •ìƒì ì¸ ì—…ë¬´ ì²˜ë¦¬ ì¤‘ ì¸ê²© ëª¨ë… ë°œì–¸." },
                { id: 8, title: "ë¶ˆê°€ëŠ¥í•œ ìš”êµ¬ì™€ ê³ ì„±", initial: "ë¯¼ì›ì¸ì´ ë¬¼ë¦¬ì ìœ¼ë¡œ ë¶ˆê°€ëŠ¥í•œ ìš”êµ¬ë¥¼ í•˜ë©° ì†Œë¦¬ë¥¼ ì§€ë¦…ë‹ˆë‹¤.\n\në¯¼ì›ì¸: \"ì˜¤ëŠ˜ ë‹¹ì¥ ì²˜ë¦¬í•´ì£¼ì„¸ìš”! ì§€ê¸ˆ ë°”ë¡œìš”! ì•ˆ ë˜ë©´ ë‚´ê°€ ì§ì ‘ ì˜¬ë¼ê°ˆ ê±°ì˜ˆìš”! (ê³ í•¨) ë‹¹ì¥ í•´ê²°í•˜ë¼ê³ ìš”!\"", context: "ë²•ì • ì²˜ë¦¬ ê¸°ê°„ì´ ì •í•´ì ¸ ìˆì–´ ë‹¹ì¼ ì²˜ë¦¬ ë¶ˆê°€ëŠ¥." },
                { id: 9, title: "ë…¹ìŒ í˜‘ë°• ë° ì™œê³¡", initial: "ë¯¼ì›ì¸ì´ í†µí™”ë¥¼ ë…¹ìŒí•˜ê³  ìˆë‹¤ë©° í˜‘ë°•í•©ë‹ˆë‹¤.\n\në¯¼ì›ì¸: \"ë‚˜ ì§€ê¸ˆ ë…¹ìŒí•˜ê³  ìˆì–´ìš”. ë‹¹ì‹ ì´ í•œ ë§ ë‹¤ ê¸°ë¡ë˜ëŠ” ê±° ì•Œì£ ? ë‚˜ì¤‘ì— ë²•ì  ì¡°ì¹˜ ì·¨í•  ê±°ë‹ˆê¹Œ ë§ ì¡°ì‹¬í•˜ì„¸ìš”. 'ì•ˆ ëœë‹¤'ê³  ë§í•˜ë©´ ì±…ì„ì§ˆ ìˆ˜ ìˆì–´ìš”?\"", context: "ì •ë‹¹í•œ ê·œì • ì•ˆë‚´ë¥¼ ë…¹ìŒ í˜‘ë°•ìœ¼ë¡œ ë°©í•´í•˜ë ¤ëŠ” ì‹œë„." },
                { id: 10, title: "ê±°ì§“ ë¯¼ì› ë° ì±…ì„ ì „ê°€", initial: "ë¯¼ì›ì¸ì´ ì‚¬ì‹¤ê³¼ ë‹¤ë¥¸ ì£¼ì¥ì„ í•˜ë©° ì±…ì„ì„ ì „ê°€í•©ë‹ˆë‹¤.\n\në¯¼ì›ì¸: \"ì €ë²ˆì— ì „í™”í–ˆì„ ë•Œ ë‹´ë‹¹ìê°€ ê°€ëŠ¥í•˜ë‹¤ê³  í–ˆì–´ìš”. ê·¸ëŸ°ë° ì™œ ì§€ê¸ˆ ì•ˆ ëœë‹¤ê³  í•´ìš”? ë‹¹ì‹ ë„¤ ê¸°ê´€ì—ì„œ ê±°ì§“ë§í•œ ê±° ì•„ë‹ˆì—ìš”? ë³´ìƒí•´ì£¼ì„¸ìš”!\"", context: "ê¸°ë¡ í™•ì¸ ê²°ê³¼ ê·¸ëŸ° ì•ˆë‚´ë¥¼ í•œ ì ì´ ì—†ìŒ." }
            ];

            const startGame = () => setStage('guide');
            const startScenarios = () => { setStage('scenario'); setCurrentScenario(0); setConversationTurn(0); setScore(0); setConversation([]); setScenarioResults([]); };

            const askSupervisor = async () => {
                setShowSupervisor(true);
                setAiLoading(true);
                try {
                    const conversationHistory = conversation.map((msg, idx) => `${idx % 2 === 0 ? 'ë¯¼ì›ì¸' : 'ì§ì›'}: ${msg}`).join('\n');
                    const prompt = `ë‹¹ì‹ ì€ ê³µê³µê¸°ê´€ì˜ ê²½í—˜ ë§ì€ ìƒì‚¬ì…ë‹ˆë‹¤. ì‹ ì… ì§ì›ì´ ì•…ì„±ë¯¼ì› ëŒ€ì‘ ì¤‘ ë„ì›€ì„ ìš”ì²­í–ˆìŠµë‹ˆë‹¤.\n\n**ìƒí™©**: ${scenarios[currentScenario].title}\n${scenarios[currentScenario].context}\n\n**ì´ˆê¸° ìƒí™©**: ${scenarios[currentScenario].initial}\n\n**í˜„ì¬ê¹Œì§€ ëŒ€í™”**:\n${conversationHistory}\n\nì‹ ì… ì§ì›ì—ê²Œ ë‹¤ìŒì„ í¬í•¨í•œ ì¡°ì–¸ì„ 200ì ë‚´ì™¸ë¡œ ê°„ë‹¨ëª…ë£Œí•˜ê²Œ ì œê³µí•´ì£¼ì„¸ìš”:\n1. í˜„ì¬ ëŒ€ì‘ì˜ ì ì ˆì„±\n2. ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì£¼ì˜í•  ì \n3. í™œìš©í•  ìˆ˜ ìˆëŠ” ê·œì •ì´ë‚˜ ì ˆì°¨\n\nìƒì‚¬ì˜ í†¤ìœ¼ë¡œ ì¹œì ˆí•˜ê³  ì‹¤ìš©ì ì¸ ì¡°ì–¸ì„ í•´ì£¼ì„¸ìš”.`;
                    
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt, type: 'advice' })
                    });
                    const data = await response.json();
                    setSupervisorAdvice(data.response);
                } catch (error) {
                    setSupervisorAdvice("ìƒì‚¬ì™€ ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìŠ¤ìŠ¤ë¡œ íŒë‹¨í•˜ì—¬ ëŒ€ì‘í•´ì£¼ì„¸ìš”.");
                } finally {
                    setAiLoading(false);
                }
            };

            const closeSupervisor = () => setShowSupervisor(false);

            const handleSubmit = async () => {
                if (!userResponse.trim()) return;
                const updatedConversation = [...conversation, userResponse];
                setConversation(updatedConversation);
                setUserResponse('');
                setAiLoading(true);

                try {
                    const conversationHistory = updatedConversation.map((msg, idx) => `${idx % 2 === 0 ? 'ë¯¼ì›ì¸' : 'ì§ì›'}: ${msg}`).join('\n');
                    const isLastTurn = conversationTurn >= 2;

                    const prompt = isLastTurn 
                        ? `ë‹¹ì‹ ì€ ê³µê³µê¸°ê´€ ì•…ì„±ë¯¼ì› ëŒ€ì‘ ì „ë¬¸ê°€ì´ì ì‹œë®¬ë ˆì´ì…˜ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.\n\n**ì‹œë‚˜ë¦¬ì˜¤**: ${scenarios[currentScenario].title}\n**ë°°ê²½**: ${scenarios[currentScenario].context}\n**ì´ˆê¸° ìƒí™©**: ${scenarios[currentScenario].initial}\n\n**í˜„ì¬ê¹Œì§€ ëŒ€í™”**:\n${conversationHistory}\n\n**í˜„ì¬ í„´**: ${conversationTurn + 1}/3\n\nì´ì œ ë§ˆì§€ë§‰ í„´ì…ë‹ˆë‹¤. ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•´ì£¼ì„¸ìš”:\n\n1. **ë¯¼ì›ì¸ ë°˜ì‘** (2-3ë¬¸ì¥): ì§ì›ì˜ ëŒ€ì‘ì— ëŒ€í•œ ë¯¼ì›ì¸ì˜ ë§ˆì§€ë§‰ ë°˜ì‘\n2. **í‰ê°€ ë° í”¼ë“œë°±** (250-300ì):\n   - ì „ì²´ 3í„´ ëŒ€ì‘ ê³¼ì • ì¢…í•© í‰ê°€\n   - ê° í„´ë³„ ëŒ€ì‘ì˜ ì ì ˆì„±\n   - ì˜í•œ ì ê³¼ ê°œì„ í•  ì \n   - ì ìˆ˜ (0-33ì , ìµœëŒ€ 33ì )\n   \ní˜•ì‹:\n[ë¯¼ì›ì¸ ë°˜ì‘]\n(ë¯¼ì›ì¸ì˜ ë°˜ì‘)\n\n[í‰ê°€]\n(í‰ê°€ ë‚´ìš©)\n\n[ì ìˆ˜]\nXX/33ì `
                        : `ë‹¹ì‹ ì€ ê³µê³µê¸°ê´€ ì•…ì„±ë¯¼ì› ëŒ€ì‘ ì „ë¬¸ê°€ì´ì ì‹œë®¬ë ˆì´ì…˜ ì‹œìŠ¤í…œì…ë‹ˆë‹¤.\n\n**ì‹œë‚˜ë¦¬ì˜¤**: ${scenarios[currentScenario].title}\n**ë°°ê²½**: ${scenarios[currentScenario].context}\n**ì´ˆê¸° ìƒí™©**: ${scenarios[currentScenario].initial}\n\n**í˜„ì¬ê¹Œì§€ ëŒ€í™”**:\n${conversationHistory}\n\n**í˜„ì¬ í„´**: ${conversationTurn + 1}/3\n\nì§ì›ì˜ ëŒ€ì‘ì— ëŒ€í•œ í˜„ì‹¤ì ì¸ ì•…ì„±ë¯¼ì›ì¸ì˜ ë°˜ì‘ë§Œ 2-3ë¬¸ì¥ìœ¼ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”. ì‰½ê²Œ ë§Œì¡±í•˜ì§€ ì•Šê³  ê³„ì† ë¬¸ì œë¥¼ ì œê¸°í•˜ê±°ë‚˜, íƒœë„ë¥¼ ë°”ê¾¸ê±°ë‚˜, ìƒˆë¡œìš´ ìš”êµ¬ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\në¯¼ì›ì¸ì˜ ë°˜ì‘ë§Œ ì‘ì„±í•˜ê³ , í”¼ë“œë°±ì€ ì œê³µí•˜ì§€ ë§ˆì„¸ìš”.`;

                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt, type: isLastTurn ? 'evaluate' : 'response' })
                    });

                    const data = await response.json();
                    const result = data.response;

                    if (isLastTurn) {
                        const scoreMatch = result.match(/(\d+)\/33ì /);
                        const earnedScore = scoreMatch ? parseInt(scoreMatch[1]) : 0;
                        setScore(score + earnedScore);
                        setAiFeedback(result);
                        setScenarioResults([...scenarioResults, { scenario: scenarios[currentScenario].title, score: earnedScore, maxScore: 33 }]);
                        setStage('feedback');
                    } else {
                        const complaintResponse = result.replace('[ë¯¼ì›ì¸ ë°˜ì‘]', '').trim();
                        setConversation([...updatedConversation, complaintResponse]);
                        setConversationTurn(conversationTurn + 1);
                    }
                } catch (error) {
                    alert("ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                } finally {
                    setAiLoading(false);
                }
            };

            const nextScenario = () => {
                if (currentScenario < scenarios.length - 1) {
                    setCurrentScenario(currentScenario + 1);
                    setConversationTurn(0);
                    setConversation([]);
                    setAiFeedback('');
                    setSupervisorAdvice('');
                    setShowSupervisor(false);
                    setStage('scenario');
                } else {
                    setStage('result');
                }
            };

            const restartGame = () => {
                setStage('start');
                setCurrentScenario(0);
                setConversationTurn(0);
                setScore(0);
                setConversation([]);
                setScenarioResults([]);
                setAiFeedback('');
                setSupervisorAdvice('');
                setShowSupervisor(false);
            };

            const getRank = (totalScore) => {
                const percentage = (totalScore / 330) * 100;
                if (percentage >= 90) return { rank: "ìµœìš°ìˆ˜", color: "text-yellow-600", message: "íƒì›”í•œ ëŒ€ì‘ ëŠ¥ë ¥!" };
                if (percentage >= 75) return { rank: "ìš°ìˆ˜", color: "text-blue-600", message: "ìš°ìˆ˜í•œ ëŒ€ì‘ ëŠ¥ë ¥" };
                if (percentage >= 60) return { rank: "ì–‘í˜¸", color: "text-green-600", message: "ê¸°ë³¸ê¸° ê°–ì¶¤" };
                return { rank: "ë…¸ë ¥ í•„ìš”", color: "text-gray-600", message: "ë” ë§ì€ ì—°ìŠµì´ í•„ìš”í•´ìš”" };
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div className="max-w-5xl mx-auto">
                        {stage === 'start' && (
                            <div className="bg-white rounded-2xl shadow-2xl p-8 text-center">
                                <div className="mb-6">
                                    <svg className="w-20 h-20 mx-auto text-indigo-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                                    <h1 className="text-4xl font-bold text-gray-800 mb-2">ì•…ì„±ë¯¼ì› ëŒ€ì‘ êµìœ¡</h1>
                                    <p className="text-gray-600 text-lg">ì‹¤ì „ ëŒ€í™”í˜• ì‹œë®¬ë ˆì´ì…˜</p>
                                </div>
                                <div className="bg-indigo-50 rounded-lg p-6 mb-6 text-left">
                                    <h3 className="font-bold text-indigo-900 mb-3">ê²Œì„ ì†Œê°œ</h3>
                                    <ul className="space-y-2 text-gray-700">
                                        <li>â€¢ 10ê°€ì§€ ì‹¤ì œ ì•…ì„±ë¯¼ì› ìƒí™©</li>
                                        <li>â€¢ ê° ìƒí™©ë‹¹ 3íšŒ ëŒ€í™” ìƒí˜¸ì‘ìš©</li>
                                        <li>â€¢ ì§ì ‘ ë‹µë³€ ì‘ì„± (ììœ  ì…ë ¥)</li>
                                        <li>â€¢ ìƒì‚¬ ì¡°ì–¸ ê¸°ëŠ¥ í™œìš© ê°€ëŠ¥</li>
                                        <li>â€¢ AI ì „ë¬¸ê°€ì˜ ì‹¤ì‹œê°„ í”¼ë“œë°±</li>
                                        <li>â€¢ ì´ 330ì  ë§Œì  í‰ê°€</li>
                                    </ul>
                                </div>
                                <button onClick={startGame} className="bg-indigo-600 text-white px-8 py-4 rounded-lg text-xl font-bold hover:bg-indigo-700 transition-colors shadow-lg">êµìœ¡ ì‹œì‘í•˜ê¸°</button>
                            </div>
                        )}

                        {stage === 'guide' && (
                            <div className="bg-white rounded-2xl shadow-2xl p-8">
                                <h2 className="text-3xl font-bold text-gray-800 mb-6">ì•…ì„±ë¯¼ì› ëŒ€ì‘ ê°€ì´ë“œ</h2>
                                <div className="space-y-6 mb-8">
                                    {guidelines.map((section, idx) => (
                                        <div key={idx} className="bg-gray-50 rounded-lg p-6">
                                            <h3 className="text-xl font-bold text-indigo-900 mb-4">{section.title}</h3>
                                            <ul className="space-y-2">
                                                {section.items.map((item, itemIdx) => (
                                                    <li key={itemIdx} className="flex items-start text-gray-700">
                                                        <svg className="w-5 h-5 text-green-500 mr-2 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                                        <span>{item}</span>
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                                    <p className="text-yellow-800"><strong>ğŸ’¡ Tip:</strong> ë§‰íˆë©´ ì–¸ì œë“  'ìƒì‚¬ì—ê²Œ ë¬¸ì˜' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¡°ì–¸ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
                                </div>
                                <button onClick={startScenarios} className="w-full bg-indigo-600 text-white py-4 rounded-lg text-xl font-bold hover:bg-indigo-700 transition-colors">ì‹¤ì „ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘</button>
                            </div>
                        )}

                        {stage === 'scenario' && (
                            <div className="bg-white rounded-2xl shadow-2xl p-8">
                                <div className="mb-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <span className="text-sm font-semibold text-indigo-600">ìƒí™© {currentScenario + 1} / {scenarios.length} | í„´ {conversationTurn + 1} / 3</span>
                                        <span className="text-sm font-semibold text-gray-600">ëˆ„ì  ì ìˆ˜: {score}/330ì </span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-2">
                                        <div className="bg-indigo-600 h-2 rounded-full transition-all" style={{ width: `${((currentScenario * 3 + conversationTurn) / 30) * 100}%` }} />
                                    </div>
                                </div>
                                <h3 className="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                                    <svg className="w-6 h-6 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                                    {scenarios[currentScenario].title}
                                </h3>
                                <div className="space-y-4 mb-6 max-h-96 overflow-y-auto">
                                    {conversation.length === 0 && (
                                        <div className="bg-red-50 rounded-lg p-4 border-l-4 border-red-500">
                                            <div className="flex items-start">
                                                <svg className="w-5 h-5 text-red-600 mr-2 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                                                <div>
                                                    <p className="font-bold text-red-900 mb-1">ë¯¼ì›ì¸</p>
                                                    <p className="text-gray-800 whitespace-pre-line">{scenarios[currentScenario].initial}</p>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                    {conversation.map((msg, idx) => (
                                        <div key={idx} className={`rounded-lg p-4 border-l-4 ${idx % 2 === 0 ? 'bg-blue-50 border-blue-500' : 'bg-red-50 border-red-500'}`}>
                                            <div className="flex items-start">
                                                <svg className={`w-5 h-5 mr-2 mt-1 ${idx % 2 === 0 ? 'text-blue-600' : 'text-red-600'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d={idx % 2 === 0 ? "M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" : "M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"} /></svg>
                                                <div className="flex-1">
                                                    <p className={`font-bold mb-1 ${idx % 2 === 0 ? 'text-blue-900' : 'text-red-900'}`}>{idx % 2 === 0 ? 'ì§ì› (ë‚˜)' : 'ë¯¼ì›ì¸'}</p>
                                                    <p className="text-gray-800 whitespace-pre-line">{msg}</p>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                {!aiLoading && (
                                    <div className="space-y-3">
                                        <div className="flex gap-2 mb-2">
                                            <button onClick={askSupervisor} className="flex items-center gap-2 px-4 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition-colors text-sm font-semibold">
                                                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                                                ìƒì‚¬ì—ê²Œ ë¬¸ì˜
                                            </button>
                                            <span className="text-xs text-gray-500 self-center">ë§‰íˆë©´ ì–¸ì œë“  ì¡°ì–¸ì„ êµ¬í•˜ì„¸ìš”!</span>
                                        </div>
                                        <textarea value={userResponse} onChange={(e) => setUserResponse(e.target.value)} placeholder="ë¯¼ì›ì¸ì—ê²Œ ì–´ë–»ê²Œ ì‘ë‹µí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì‹¤ì œë¡œ ë§í•  ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”..." className="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none resize-none" rows="4" />
                                        <button onClick={handleSubmit} disabled={!userResponse.trim()} className="w-full bg-indigo-600 text-white py-3 rounded-lg font-bold hover:bg-indigo-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">ì‘ë‹µ ì „ì†¡</button>
                                    </div>
                                )}
                                {aiLoading && (
                                    <div className="flex items-center justify-center py-8">
                                        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                                        <span className="ml-3 text-gray-600">ë¯¼ì›ì¸ ë°˜ì‘ ìƒì„± ì¤‘...</span>
                                    </div>
                                )}
                                {showSupervisor && (
                                    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                        <div className="bg-white rounded-2xl p-6 max-w-2xl w-full">
                                            <div className="flex items-center mb-4">
                                                <svg className="w-8 h-8 text-purple-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                                                <h3 className="text-2xl font-bold text-gray-800">ìƒì‚¬ì˜ ì¡°ì–¸</h3>
                                            </div>
                                            {aiLoading ? (
                                                <div className="flex items-center justify-center py-8">
                                                    <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
                                                    <span className="ml-3 text-gray-600">ì¡°ì–¸ ë°›ëŠ” ì¤‘...</span>
                                                </div>
                                            ) : (
                                                <div className="bg-purple-50 rounded-lg p-6 mb-6">
                                                    <p className="text-gray-800 whitespace-pre-line leading-relaxed">{supervisorAdvice}</p>
                                                </div>
                                            )}
                                            <button onClick={closeSupervisor} disabled={aiLoading} className="w-full bg-purple-600 text-white py-3 rounded-lg font-bold hover:bg-purple-700 transition-colors disabled:bg-gray-400">ì¡°ì–¸ í™•ì¸í•˜ê³  ëŒì•„ê°€ê¸°</button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {stage === 'feedback' && (
                            <div className="bg-white rounded-2xl shadow-2xl p-8">
                                <div className="text-center mb-6">
                                    <svg className="w-16 h-16 text-indigo-600 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                    <h3 className="text-2xl font-bold text-indigo-600">ìƒí™© {currentScenario + 1} ì™„ë£Œ</h3>
                                    <p className="text-gray-600 mt-2">{scenarios[currentScenario].title}</p>
                                </div>
                                <div className="bg-indigo-50 rounded-lg p-6 mb-6">
                                    <h4 className="font-bold text-indigo-900 mb-3">AI ì „ë¬¸ê°€ ì¢…í•© í‰ê°€</h4>
                                    <p className="text-gray-700 leading-relaxed whitespace-pre-line">{aiFeedback}</p>
                                </div>
                                <button onClick={nextScenario} className="w-full bg-indigo-600 text-white py-4 rounded-lg text-xl font-bold hover:bg-indigo-700 transition-colors">
                                    {currentScenario < scenarios.length - 1 ? 'ë‹¤ìŒ ìƒí™©ìœ¼ë¡œ' : 'ìµœì¢… ê²°ê³¼ ë³´ê¸°'}
                                </button>
                            </div>
                        )}

                        {stage === 'result' && (
                            <div className="bg-white rounded-2xl shadow-2xl p-8">
                                <div className="text-center mb-8">
                                    <svg className="w-20 h-20 mx-auto text-yellow-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" /></svg>
                                    <h2 className="text-3xl font-bold text-gray-800 mb-2">êµìœ¡ ì™„ë£Œ!</h2>
                                    <div className="text-6xl font-bold text-indigo-600 my-4">{score}<span className="text-3xl text-gray-500">/330ì </span></div>
                                    <div className={`text-2xl font-bold ${getRank(score).color}`}>{getRank(score).rank}</div>
                                    <p className="text-gray-600 mt-2">{getRank(score).message}</p>
                                </div>
                                <div className="bg-gray-50 rounded-lg p-6 mb-6">
                                    <h3 className="font-bold text-gray-800 mb-4">ìƒí™©ë³„ ìƒì„¸ ê²°ê³¼</h3>
                                    <div className="space-y-3">
                                        {scenarioResults.map((result, idx) => (
                                            <div key={idx} className="flex items-center justify-between p-4 bg-white rounded-lg shadow-sm">
                                                <div className="flex-1">
                                                    <p className="font-semibold text-gray-800">{idx + 1}. {result.scenario}</p>
                                                </div>
                                                <div className="text-right">
                                                    <span className={`text-lg font-bold ${result.score >= 28 ? 'text-green-600' : result.score >= 20 ? 'text-blue-600' : result.score >= 13 ? 'text-yellow-600' : 'text-gray-600'}`}>
                                                        {result.score}/{result.maxScore}ì 
                                                    </span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                    <div className="bg-blue-50 rounded-lg p-4 text-center">
                                        <p className="text-sm text-blue-600 font-semibold mb-1">í‰ê·  ì ìˆ˜</p>
                                        <p className="text-2xl font-bold text-blue-900">{(score / 10).toFixed(1)}ì </p>
                                    </div>
                                    <div className="bg-green-50 rounded-lg p-4 text-center">
                                        <p className="text-sm text-green-600 font-semibold mb-1">ë‹¬ì„±ë¥ </p>
                                        <p className="text-2xl font-bold text-green-900">{((score / 330) * 100).toFixed(1)}%</p>
                                    </div>
                                    <div className="bg-purple-50 rounded-lg p-4 text-center">
                                        <p className="text-sm text-purple-600 font-semibold mb-1">ì™„ë£Œ ìƒí™©</p>
                                        <p className="text-2xl font-bold text-purple-900">10/10</p>
                                    </div>
                                </div>
                                <div className="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">
                                    <p className="text-blue-800"><strong>ğŸ“š í•™ìŠµ í¬ì¸íŠ¸:</strong> ì•…ì„±ë¯¼ì› ëŒ€ì‘ì˜ í•µì‹¬ì€ ì¹¨ì°©í•¨ ìœ ì§€, ê·œì • ì¤€ìˆ˜, ê³µê°ì  íƒœë„ì…ë‹ˆë‹¤. ìƒì‚¬ì˜ ì¡°ì–¸ì„ ì ì ˆíˆ í™œìš©í•˜ê³ , 3íšŒì— ê±¸ì¹œ ëŒ€í™”ë¡œ ì ì§„ì ìœ¼ë¡œ ìƒí™©ì„ í•´ê²°í•˜ëŠ” ëŠ¥ë ¥ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.</p>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <button onClick={restartGame} className="bg-indigo-600 text-white py-4 rounded-lg text-lg font-bold hover:bg-indigo-700 transition-colors">ë‹¤ì‹œ ë„ì „í•˜ê¸°</button>
                                    <button onClick={() => setStage('guide')} className="bg-gray-600 text-white py-4 rounded-lg text-lg font-bold hover:bg-gray-700 transition-colors">ê°€ì´ë“œ ë‹¤ì‹œ ë³´ê¸°</button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
